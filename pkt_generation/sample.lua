local ts = os.date('!%Y-%m-%dT%H:%M:%S'); local rate = pktgen.portStats(0, 'rate'); if rate and rate[0] then local f1 = io.open('/tmp/port_rate_stats.csv', 'a'); local str = ts .. ','; for k,v in pairs(rate[0]) do str = str .. k .. '=' .. tostring(v) .. ',' end; f1:write(str:sub(1, -2), '\n'); f1:close(); end; local pkt = pktgen.pktStats(0)[0]; if pkt then local f2 = io.open('/tmp/pkt_stats.csv', 'a'); local str = ts .. ','; for k,v in pairs(pkt) do str = str .. k .. '=' .. tostring(v) .. ',' end; f2:write(str:sub(1, -2), '\n'); f2:close(); end; local port = pktgen.portStats(0, 'port'); if port and port[0] then local f3 = io.open('/tmp/port_stats.csv', 'a'); local str = ts .. ','; for k,v in pairs(port[0]) do str = str .. k .. '=' .. tostring(v) .. ',' end; f3:write(str:sub(1, -2), '\n'); f3:close(); end; 